#Workflow name
name: Create Github Action to comment an AI generated image and a quote

#Trigger workflow when issue is raised
on: 
  issues:
    type:
      - opened

jobs:
  ai_image_and_quote:
    runs-on: ubuntu-latest
    steps: 
    #Ensuring access to repo files
      - name: Checkout Repository
        uses: actions/checkout@v3
        
    #Getting username to print in message
      - name: Get User
        id: usern
        run: echo "set-output name=user_n::${{ github.event.issue.user.login }}"
    
    #Get AI generated image
      - name: AI Image Generator
        id: generate_ai
        run: |
          curl -o image.jpg https://thispersondoesnotexist.com/image
          
      - name: Upload Image as Comment
        uses: actions/upload-artifact@v3
        with:
          name: generated-image
          path: image.jpg
    
    #Printing comment(have used Create or Update Comment Github 
    #Action on the Marketplace here
      - name: Comment on Issue
        uses: actions/github-script@v4
        with:
          github-token: ${{ secrets.TOKEN }}
          script: |
            const fs = require('fs');
            const image = fs.readFileSync('image.jpg', 'base64');
            
            const body = `![Generated Image](data:image/jpeg;base64,${image})`;
            github.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: body
            });

    
    
    
    
        
    
